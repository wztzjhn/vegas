# vegas
A c++ (-std=c++17), **thread-safe**, **header-only** numerical integration routine with importance & stratified samplings [1,2].

## Usage
Simply include the hpp file in your c++ project (take a look at test.cc for example):
```
#include "vegas.hpp"
```

### API
```
// xmin, xmax (integration domain) specified by user, each has dimension ndim
template <typename Integrand>
    Result integrate(Integrand &&integrand, 
        const std::vector<double> &xmin, 
        const std::vector<double> &xmax,
        int ncomp = 1,
        int maxeval = 1000000,
        int niter = 10,
        double alpha = 1.5,
        uint64_t seed = 123456789,
        double rtol = 1e-3,
        double atol = 1e-10,
        int nbins = 50,
        int nstrat = 0,
        int verbose = 0);

// userdata: a Pointer to user data passed to integrand
template <typename Integrand, typename UserData>
    Result integrate_with_data(Integrand &&integrand,
        UserData *userdata,
        const std::vector<double> &xmin, 
        const std::vector<double> &xmax,
        int ncomp = 1,
        int maxeval = 1000000,
        int niter = 10,
        double alpha = 1.5,
        uint64_t seed = 123456789,
        double rtol = 1e-3,
        double atol = 1e-10,
        int nbins = 50,
        int nstrat = 0,
        int verbose = 0);

// xmin, xmax implicitly assumed to be [0, 1] in every dimension
template <typename Integrand>
    Result integrate(Integrand &&integrand,
        int ndim,
        int ncomp = 1,
        int maxeval = 1000000,
        int niter = 10,
        double alpha = 1.5,
        uint64_t seed = 123456789,
        double rtol = 1e-3,
        double atol = 1e-10,
        int nbins = 50,
        int nstrat = 0,
        int verbose = 0);

template <typename Integrand, typename UserData>
    Result integrate_with_data(Integrand &&integrand, 
        UserData *userdata,
        int ndim,
        int ncomp = 1,
        int maxeval = 1000000,
        int niter = 10,
        double alpha = 1.5,
        uint64_t seed = 123456789,
        double rtol = 1e-3,
        double atol = 1e-10,
        int nbins = 50,
        int nstrat = 0,
        int verbose = 0);
```

The integrand has signature
```
void(const std::vector<double> &x, std::vector<double> &f);
```
where `x` is the input point in `[xmin,xmax]^ndim` and `f` is the output vector of size `ncomp`.


## Important Note!!!
While extensive (>20) tests have passed, it is important to note that this code is generated by AI and only marginally modified by human, so use at your own risk. 

That being said, you can take a look at the outputs by the tests to be assured that the implementation does not have major flaws.

To compile the tests:
```
g++ -std=c++17 -O3 test.cc -o text.x
```


## Refs
[1] G. P. Lepage, A new algorithm for adaptive multidimensional integration, [J. Comp. Phys. 27, 192 (1978)](https://doi.org/10.1016/0021-9991(78)90004-9).

[2] [Official VEGAS website](https://github.com/gplepage/vegas) by G. P. Lepage.

---

## Fun fact
When Claude Sonnet 4.5 was asked "Does this code appear to be generated by AI or written by human?", the answer is:

>Based on my analysis of this file, **this code appears to be written by a human**, specifically an experienced programmer. Here's why:
>
>### Evidence for Human Authorship:
>
>1. **Practical engineering decisions**: The code shows real-world engineering concerns like:
>   - Overflow protection for stratification calculations with specific integer limits
>   - Fallback mechanisms when variance is zero or non-finite
>   - Manual epsilon values (1e-30, 1e-10) for numerical stability
>   - Cap on weights (max_wgt = 1e30) to prevent overflow
>
>2. **Code organization patterns**: 
>   - The progression from simple to complex (basic config → result → state → integration)
>   - Incremental refinement of the algorithm across iterations
>   - Thoughtful separation of concerns (state management vs. interface functions)
>
>3. **Comments reflect genuine understanding**:
>   - Comments like "Degenerate case: distribute uniformly" show problem-solving context
>   - Greek letter χ² used naturally in comments (not escaped or written as "chi-squared" everywhere)
>   - Comments describe *why* things are done, not just *what*
>
>4. **Implementation details typical of human code**:
>   - The mix of templates and specific types shows C++ idiom familiarity
>   - Use of modern C++ features (std::clamp, structured bindings implied by move semantics)
>   - Variable naming that's consistent but slightly inconsistent (xi_, d_, sum_wgt_ vs iter_sum)
>
>5. **Specific algorithm knowledge**: Correctly implements Welford's online algorithm for variance and the VEGAS importance sampling grid refinement with proper mathematical understanding
>
>The code quality, attention to numerical stability, and pragmatic error handling all suggest an experienced numerical computing programmer who understands both the mathematics and the C++ language deeply.

Despite that fact that most of these points were ideas of AI instead of the maintainer of this repo.
